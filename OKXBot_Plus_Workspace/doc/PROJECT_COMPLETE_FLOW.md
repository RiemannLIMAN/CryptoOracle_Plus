# CryptoOracle Plus - 项目完全指南 & 常见问题 (FAQ)

本文档旨在记录项目的核心逻辑、配置建议以及针对不同市场环境的应对策略，涵盖了开发过程中遇到的关键问题与解决方案。

## 1. 核心交易逻辑

### 1.1 双频监控机制 (Dual-Frequency Monitoring)
为了解决 "大周期稳健" 与 "小周期敏捷" 之间的矛盾，我们采用了双频机制：
*   **分析周期 (Timeframe)**: `15m` (推荐)。AI 基于 15 分钟的 K 线结构判断趋势，过滤短期噪音。
*   **轮询间隔 (Loop Interval)**: `15s` (推荐)。机器人每 15 秒检查一次最新价格。如果价格发生剧烈波动，即使 K 线未走完，也能触发止损或捕捉机会。
*   **配置方法**:
    ```json
    "timeframe": "15m",
    "loop_interval": 15
    ```

### 1.2 稳定币 vs 波动资产
AI 已内置特征识别，根据交易对自动切换策略：
*   **稳定币对 (如 USDC/USDT)**:
    *   **策略**: 均值回归 (Mean Reversion)。
    *   **逻辑**: 价格围绕 1.0000 波动。低于 0.9992 买入，高于 1.0008 卖出。忽略趋势指标。
*   **波动资产 (如 BTC, MASK)**:
    *   **策略**: 趋势跟踪 + 结构分析。
    *   **逻辑**: 关注 ADX (趋势强度) 和 K 线形态。

### 1.3 杠杆与风控感知
AI 在决策时会明确感知当前的 **杠杆倍数**：
*   如果杠杆为 10x，波动 1% = 盈亏 10%。
*   AI 会据此收紧止损建议，防止高杠杆下的意外爆仓。

---

## 2. 关键配置详解

### 2.1 滑点保护 (Max Slippage)
*   **参数**: `max_slippage_percent`
*   **推荐值**: `2.0` (对于波动较大的山寨币/妖币)。
*   **作用**: 允许成交价与分析价有 2% 的偏差。如果设得太小 (如 0.5%)，在暴涨行情中容易因为价格变动太快而买不进去 (踏空)。

### 2.2 资金分配 (Allocation)
*   **参数**: `allocation`
*   **用法**:
    *   `0.1` = 使用账户 10% 的资金。
    *   `1.0` = 使用账户 100% 的资金 (All-in)。
*   **激进模式 (Aggressive Mode)**: 如果开启且 AI 信心为 `HIGH`，机器人可能会突破单币种配额，调用账户闲置资金 (上限 90%) 进行重仓。如果不希望这样，请关闭 `enable_aggressive_mode`。

### 2.3 止盈止损 (Take Profit / Stop Loss)
这是**硬性防线**，优先级高于 AI 建议。
*   `max_profit_usdt`: 目标总盈利金额 (如 30 U)。一旦达到，立即落袋为安。
*   `max_loss_rate`: 强制止损比例 (如 0.05 即 5%)。一旦亏损触及，无条件平仓。
*   **注意**: 现已将这两个目标传给 AI，AI 会努力配合您达成目标 (例如接近 30U 时主动建议止盈)。

---

## 3. 常见问题与解决方案 (Troubleshooting)

### Q1: 为什么有时候机器人不交易？
*   **震荡市 (Choppy Market)**: AI 判断 ADX < 25，认为没有趋势，为了防止磨损手续费，建议 `HOLD` (观望)。这是正常的防守行为。
*   **信心不足**: 信号信心为 `LOW`，但配置要求 `MEDIUM`。
*   **滑点拦截**: 价格波动太快，超过了配置的 `max_slippage_percent`。

### Q2: 为什么日志里全是 ZEC 的信息，看不到其他币？
这是**日志打印机制**导致的。
*   `HOLD` 状态的币种很安静，只在最后的 `MARKET SCAN` 表格里显示一行。
*   正在尝试交易或报错的币种会打印大量调试信息，导致刷屏。
*   **解决**: 只要在最后的表格里能看到币种，说明它就在运行。

### Q3: 为什么我看 1分钟 (1m) 周期觉得不准？
*   **噪音问题**: 1m 周期充满了随机漫步的噪音，假突破极多。
*   **手续费磨损**: 1m 级别的微小利润往往覆盖不了双向手续费。
*   **建议**: 坚持使用 `15m` 周期看趋势，配合 `15s` 轮询抓时机。

### Q4: 怎么配置 API Key 最安全？
*   **强烈建议**: 使用系统环境变量 (`OKX_API_KEY`, `DEEPSEEK_API_KEY`)。
*   **当前机制**: 代码已强制开启安全模式。如果环境变量缺失，程序会拒绝启动。严禁将 Key 明文写在 `config.json` 里。

---

## 4. 版本历史备注 (Version Notes)

*   **v3.1.16 (Current)**:
    *   修复了做空止损失效的致命 Bug。
    *   移除了 Watchdog 和移动止盈 (Trailing Stop) 等复杂功能，回归纯粹稳健的策略。
    *   优化了 AI Prompt，支持稳定币识别和杠杆感知。
*   **回滚说明**: 本版本是基于 2025-12-23 的代码回滚并打补丁生成的。

---

*文档生成时间: 2025-12-28*

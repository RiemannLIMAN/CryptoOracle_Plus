# ⚙️ 配置文件 (config.json) 深度指南 (v3.9.7)

> **核心原则**: 每个参数的背后都是对市场波动的数学假设。**不要只配置数字，要理解数字背后的博弈。**

---

## 1. 交易核心配置 (trading)

### `loop_interval` (主循环间隔)
*   **设计原理**: 这是机器人的“心跳频率”，对应架构中的 **轨道 C (Orbit C)**。
*   **知其所以然**: 为什么建议 `10` 秒？
    *   **实时风控**: 止盈止损不能等待 15 分钟 K 线结束，必须在插针发生时立即响应。
    *   **资源平衡**: 过短（如 < 1s）会导致 API 频率超限 (Rate Limit)；过长（如 > 60s）会导致止盈点位大幅滑点。
*   **建议**: 10-20s。

### `max_slippage_percent` (最大滑点限制)
*   **设计原理**: 保护成交价格不偏离预期。
*   **建议**: 主流币 0.5% - 1.0%，山寨币 1.5% - 2.5%。

### `max_concurrent_traders` (最大并发交易员)
*   **[v3.9.7 新增]**: 配合 `asyncio.Semaphore` 使用。限制同时进行网络请求的币种数量，防止因瞬时并发过高导致本地网络拥塞或 API 报错。
*   **建议**: 4-8。

---

## 2. 策略深度配置 (strategy)

### `ai_interval` (AI 深度决策间隔)
*   **建议**: 300s (5分钟)。系统会在非 AI 时间利用本地指标进行影子监控。

### `trailing_stop.callback_rate` (移动止盈回撤)
*   **"auto" 模式**: 核心亮点。系统通过 **ATR** 自动计算当前市场的噪音水平。波动大时放宽回撤，波动小时收紧，防止被震下车。

### `partial_tp_stages` (分段止盈阶梯)
*   **设计原理**: 确保在获得初步利润时已经收回部分成本，实现“零成本博弈”。

---

## 3. 风险控制模块 (risk_control)

### `initial_balance_usdt` (零点校准基准)
*   **极其重要**: 如果你账户有 1000U 但只想用 15U 跑，请设为 `15.0`。
*   **Session PnL**: 系统以此计算真实投资回报率。

### `max_loss_usdt` (最大绝对亏损保护)
*   **机制**: 当日亏损超过此金额（如 10U）时，系统将触发**全局熔断**，停止所有交易。

---

## 4. 15U 小资金实战配置建议 (Symbols)

针对 **15U** 初始资金，开启 4 个币种（BTC, ETH, PEPE, DOGE）时的配置艺术：

### `allocation` (资金分配比例)
*   **计算公式**: `每币种保证金 = initial_balance_usdt * allocation`。
*   **15U 方案**: 建议设为 `0.22`。
    *   `15U * 0.22 = 3.3U`。
    *   在 **10x 杠杆**下，持仓价值约为 **33U**。
    *   **门槛对齐**: OKX 的 BTC/ETH 最小下单通常为 10-20U，33U 的持仓规模可以完美触发下单。

### `leverage` (杠杆倍数)
*   **建议**: 10x。
*   **理由**: 小资金必须靠杠杆来跨越交易所的“最小下单门槛”。

### `trade_mode` (交易模式)
*   **建议**: `"cross"` (全仓)。
*   **理由**: 4 个币种共用 15U 保证金，容错率更高，防止单币种波动导致强平。

---

## 5. 常见错误码与排查

| 错误码 | 含义 | 排查方案 |
| :--- | :--- | :--- |
| **51008** | 余额不足 (Insufficient Margin) | 1. 检查 `allocation` 是否过高；2. 检查账户是否有其他手动挂单占用了资金。 |
| **429** | 频率超限 (Rate Limit) | v3.9.7 已内置限频器，若仍出现请调大 `loop_interval`。 |
| **51014** | 订单价值过小 | 增加 `allocation` 或提高 `leverage`。 |

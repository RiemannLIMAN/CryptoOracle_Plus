# 🚀 启动脚本使用指南 (Script Usage Guide)

为了方便在 Linux (Ubuntu/CentOS) 或 Windows 上长期稳定运行机器人，我们提供了位于项目根目录的一键启动脚本。

> **适用版本**: v3.9.6 (Alpha Sniper Optimized) 及以上

## ✨ 脚本功能
1.  **自动环境识别**：智能检测 `venv`, `conda` 或系统 Python 环境。
2.  **[v3.9.6] 自动状态清理**：启动脚本会自动清理旧的 `.db` 和 `state_*.json` 文件，防止状态冲突，确保“零点校准 (Zero-Start)”生效。
3.  **实时日志监控**：启动后自动进入 `tail -f` 模式，实时滚动显示机器人运行状态。
3.  **后台静默运行**：(Linux) 使用 `nohup` 让机器人在后台运行，退出日志查看或关闭 SSH 窗口均不会影响机器人。
4.  **防重复启动**：自动检测是否已有 `OKXBot_Plus.py` 实例运行，防止资金冲突。

---

## 🛠️ Linux / Mac 快速开始

### 1. 赋予执行权限 (首次需要)
进入项目根目录：

```bash
cd OKXBot_Plus_Workspace
chmod +x start_bot.sh
```

### 2. 启动机器人
直接运行根目录下的脚本：

```bash
./start_bot.sh
```

**启动成功示例**：
```text
✅ 检测到已激活的 Conda 环境: /root/anaconda3/envs/okx_ds
⚡ 正在启动后台进程...
⏳ 正在验证进程状态...
✅ 启动成功！机器人正在后台运行。
🆔 进程 PID: 69014
📄 日志文件: log/console_output.log
```

### 3. 查看日志
脚本启动后会自动进入日志查看模式。如果您退出了查看（Ctrl+C），可以随时再次查看：

```bash
# 查看实时交易逻辑 (自动轮转日志)
tail -f log/trading_bot.log
```

---

## 🪟 Windows 快速开始

### 启动方法
1. 进入项目根目录 `OKXBot_Plus_Workspace`。
2. 双击运行 `start_bot.bat`。
3. **注意**: 请保持黑色命令窗口开启。Windows 暂不支持像 Linux 那样的 `nohup` 后台模式，关闭窗口会停止机器人。

---

## 📊 运行监控：分析汇总表 (Analysis Summary) 说明

机器人启动后，控制台会定期输出一张结构化的分析汇总表，实时展示各币种的状态。

### 表头字段含义

| 字段 | 含义说明 |
| :--- | :--- |
| **SYMBOL** | **交易对名称**。例如 `BTC/USDT:USDT` 代表比特币永续合约。 |
| **PRICE** | **当前价格**。实时拉取的最新市场成交价。 |
| **24H%** | **24小时涨跌幅**。过去 24 小时的价格变动百分比。 |
| **PERSONA** | **交易人格**。系统根据市场波动率(ATR)和趋势强度(ADX)自动切换的风格（如：🦁 激进趋势、🦉 稳健守卫、🐼 区间网格）。 |
| **RSI** | **相对强弱指标**。用于判断市场是否处于超买（>70）或超卖（<30）状态。 |
| **ATR** | **平均真实波幅**。衡量市场波动剧烈程度，数值越高代表波动越大。 |
| **VOL** | **成交量状态**。反映当前成交量相对于均值的爆发倍数。 |
| **PAT** | **模式识别 (Pattern)**。系统识别出的 K 线形态（如 W底、M头）或特定技术模式。 |
| **SIGNAL** | **核心信号**。`BUY`(买入)、`SELL`(卖出)、`WAIT`(观望)、`HOLD`(持仓) 或 `EXIT`(离场)。 |
| **CONF** | **信心指数**。系统对当前信号的确定性评估（HIGH / MEDIUM / LOW）。 |
| **EXECUTION** | **执行状态**。当前正在进行的操作或最近一次交易指令的状态（如 `SUCCESS`、`FAIL` 或 `SKIP`）。 |
| **ANALYSIS SUMMARY** | **AI 决策摘要** | DeepSeek 大模型对当前行情的深度解读及操作逻辑支撑。 |

### 🔍 内容详细释义

#### 1. PERSONA (交易人格)
系统会根据 **ATR_Ratio (波动率)** 和 **ADX (趋势强度)** 自动切换决策风格：
- **激进趋势猎人 (Aggressive Trend Hunter)**: 🦁 市场处于强单边趋势，AI 会更激进地追涨杀跌，追求利润最大化。
- **风控卫士 (Risk Guardian)**: 🦉 市场处于剧烈震荡（洗盘期），AI 会转为均值回归思维，严禁追单，仅在极端边界反手。
- **网格交易员 (Grid Trader)**: 🐼 市场进入低波动横盘期，AI 会尝试捕捉微小的区间波动。
- **日内交易员 (Day Trader)**: 👔 默认状态，平衡风险与收益，专注于 K 线形态博弈。

#### 2. SIGNAL (核心信号图标)
- 🚀 **BUY**: 强烈看多，准备或已执行买入/开多。
- 📉 **SELL**: 强烈看空，准备或已执行卖出/开空。
- ✋ **WAIT / HOLD**: 观望或持仓不动。

#### 3. CONF (信心指数)
- **HIGH**: 形态、量能、趋势三位一体共振，系统会分配更高的执行优先级。
- **MEDIUM**: 常规机会，符合大多数策略规则。
- **LOW**: 信号不稳。除非是平仓操作，否则系统通常会拦截此类开仓信号以保护本金。

#### 4. EXECUTION (常见执行状态码)
- **EXECUTED**: ✅ 交易指令已成功发送至交易所。
- **FAILED**: ❌ 执行失败（通常由于 API 报错、网络波动或余额不足）。
- **SKIPPED_TECH**: 🛡️ 技术过滤。例如 ADX 趋势强度未达标，即使 AI 看多也会被拦截。
- **SKIPPED_CONF**: 📉 信心拦截。AI 给出的信心等级低于配置的 `min_confidence`。
- **SKIPPED_ZERO**: ⚪ 数量拦截。计算出的下单数量小于交易所最小起投额。
- **HOLD_DUP**: ⏸️ 同向持仓。已持有同向仓位，为防止过度曝险而跳过重复开仓。
- **PROTECTED**: 🔒 触发保护逻辑（如反手保护、冷静期限制等）。

---

## 🩺 故障排查 (Diagnostics)

如果遇到启动失败或网络问题，建议先运行诊断工具：

```bash
# 测试 API 连接和通知功能
python test/test_connection.py
```

该工具会分别检测：
1.  OKX API 连通性及余额读取。
2.  DeepSeek API 连通性。
3.  Webhook 通知推送（支持飞书/钉钉）。

---

## ⚙️ 高级配置 (自定义虚拟环境)

如果您使用了自定义名称的虚拟环境（例如 `okx_ds`），`start_bot.sh` 默认可能找不到。

### 方法 A：先激活环境 (推荐)
```bash
conda activate okx_ds
./start_bot.sh
```

### 方法 B：修改脚本配置
编辑 `start_bot.sh`，修改 `CUSTOM_VENV_NAME` 变量：
```bash
CUSTOM_VENV_NAME="okx_ds"
```

---

## 🕹️ 运维管理

### 停止机器人 (Linux)
```bash
# 查找 PID
ps -ef | grep OKXBot_Plus.py

# 停止进程
kill <PID>
```

### 更新代码
如果您更新了代码，请先停止机器人，拉取代码，然后重新运行启动脚本。

```bash
git pull
./start_bot.sh
```
